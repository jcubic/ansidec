<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Client Decoding conversion</title>
    <style>
     span {
         display: inline-block;
         overflow: hidden;
         max-height: 1em;
     }
     div {
         max-height: 1em;
     }
     .zoom {
        transform: scale(1.4);
     }
     .chr {
         max-width: 1ch;
     }
     pre {
         line-height: 1em;
     }
    </style>
  </head>
  <body>
    <input id="file" type="file" />
    <label for="decode">Decode CP437</label>
    <input id="decode" type="checkbox" checked/>
    <pre id="output" style="background: black"></pre>
    <script src="index.js"></script>
    <script src="https://cdn.terminal.jcubic.pl/iconv.js"></script>
    <script>
     var output = document.getElementById('output');
     var decode = document.getElementById('decode');
     var file = document.getElementById('file');
     // ------------------------------------------------------------------------
     var format_ansi = function(string) {
         // function ansi.html don't work on some Unicode characters on Windows 7
         // this is workaroud together with css
         var spans = ansi.format(function(styles, color, background, text) {
             var style = [];
             if (color) {
                 style.push('color:' + color);
             }
             if (background) {
                 style.push('background:' + background);
             }
             if (styles.bold) {
                 style.push('font-weight:bold');
             }
             if (styles.italic) {
                 style.push('font-style:italic');
             }
             if (styles.underline) {
                 styles.push('text-decoration:underline');
             }
             var re = /[\u2580-\u25FF]/;
             /*
             var m = navigator.appVersion.match(/NT ([0-9]+)/);
             var is_windows_fix_required = m && +m[1] < 10;
             */
             text = Array.from(text).map(function(chr) {
                 var _class = "chr";
                 if (re.test(chr)) {
                     _class += ' zoom';
                 }
                 return '<span class="' + _class +'">' + chr + '</span>';
              }).join('');
             return '<span style="' + style.join(';') + '">' + text + '</span>';
         }, string);
         return spans.split(/\n/).map(function(line) {
             return '<div>' + line + '</div>';
         }).join('');
     }
     // ------------------------------------------------------------------------
     function format(input) {
         var str;
         if (typeof input === 'string') {
             str = input;
         } else {
             str = iconv.decode(Buffer.from(input), 'CP437');
         }
         output.innerHTML = format_ansi(str);
     }
     // ------------------------------------------------------------------------
     fetch('FILE_ID.ANS').then(res => res.arrayBuffer()).then(format);
     // ------------------------------------------------------------------------
     function load() {
         var reader = new FileReader();
         reader.onload = function(event) {
             format(event.target.result);
         };
         if (decode.checked) {
             reader.readAsArrayBuffer(file.files[0]);
         } else {
             reader.readAsText(file.files[0]);
         }
     }
     file.addEventListener('change', load);
     decode.addEventListener('change', load);
  </script>
  </body>
</html>
